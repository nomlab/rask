<% content_for :tag_list do %>
  <%= render partial: "layouts/tag_list", locals: { base_link: request.original_url } %>
<% end %>

<div class="d-flex align-items-center">
  <%= render 'layouts/h1', title: "タスク一覧" %>
  <div class="flex-grow-1"></div>

  <div class="border p-3 my-3 rounded d-flex gap-3">
    <table class="table mb-0">
      <thead>
        <tr>
          <th>ソート：</th>
          <th><%= sort_link(@q, :updated_at, "更新順", class: "link-primary") %></th>
          <th><%= sort_link(@q, :created_at, "作成順", class: "link-primary") %></th>
          <th><%= sort_link(@q, :due_at, "期限順", class: "link-primary") %></th>
          <th><%= sort_link(@q, :project_id, "プロジェクト名順", class: "link-primary") %></th>
        </tr>
      </thead>
    </table>
  </div>

  <div class="border p-3 my-3 rounded d-flex align-items-center gap-3">
    <%= search_form_for @q, class: "d-flex align-items-center w-100" do |f| %>
      <%= f.text_field :text_cont,
        class: "form-control me-2",
        placeholder: '検索ワードを入力して下さい',
        style: "flex: 1;" %>
      <%= preserve_other_params(except: [:q]) %>
      <%= f.submit "検索", class: "btn btn-primary" %>
    <% end %>
  </div>

  <%= link_to '新規作成', new_task_path, class: "btn btn-danger ms-3" %>
</div>

<%= form_with url: request.path, method: :get, local: true, html: { class: "d-flex" } do %>
  <%= preserve_other_params(except: [:only_todo]) %>
  <%= hidden_field_tag :only_todo, session[:only_todo] == '1' ? '0' : '1' %>
  <%= check_box_tag "", "", checked: session[:only_todo] == "1", onchange: "this.form.submit()" %>
  <div class="mx-1">
    todoのみ
  </div>
<% end %>

<ul class="text-center nav nav-tabs" role="tablist">
  <li class="nav-item w-50 bg-light">
    <%= link_to "#{current_user&.screen_name}のタスク",
        url_with_query(request.original_url, "all", "false"),
        class: "nav-link #{'active' if !session[:show_all]} link-text" %>
  </li>

  <li class="nav-item w-50 bg-light">
    <%= link_to 'すべてのタスク',
        url_with_query(request.original_url, "all", "true"),
        class: "nav-link #{'active' if session[:show_all]} link-text" %>
  </li>
</ul>

<div class="tab-content">
  <div class="tab-pane show active" id="tasks" role="tabpanel">
    <%= render @tasks %>
    <div class="row">
      <div class="col-md-12 col-sm-12 text-center hidden-xs">
        <%= raw(paginate @tasks) %>
      </div>
    </div>
  </div>
</div>

<style>
  .text-black {
    text-decoration: none;
  }
</style>
